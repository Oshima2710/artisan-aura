<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendor Registration</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>



<body class="bg-image flex justify-center items-center">
    <div class="flex m-10 p-8 bg-gray-100 rounded-lg shadow-lg w-full h-screen">
        <!-- Sidebar for Step Progress -->
    <div class="w-1/4 bg-[#FFEDE1] p-6 rounded-lg shadow-md sticky top-0">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Registration Steps</h2>
        <ul class="relative">
            <!-- Basic Details -->
            <li class="mb-2 p-2 rounded cursor-pointer flex items-center space-x-2 relative" id="step1" onclick="showStep(1)">
                <div class="flex flex-col items-center mb-[1rem]">
                    <img src="./images/1.jpg" alt="Basic Icon" class="w-6 h-6">
                    <div class="h-8 w-0.5 bg-black absolute mt-[0.2rem] left-[1.2rem] top-8"></div>
                </div>
                <span class="font-semibold">Basic Details</span>
            </li>
        
            <!-- Business Details -->
            <li class="mb-2 p-2 rounded cursor-pointer flex items-center space-x-2 relative" id="step2" onclick="showStep(2)">
                <div class="flex flex-col items-center mb-[1rem]">
                    <img src="./images/2.jpg" alt="Business Icon" class="w-6 h-6">
                    <div class="h-8 w-0.5 bg-black absolute mt-[0.2rem] left-[1.2rem] top-8"></div>
                </div>
                <span class="font-semibold ">Business Details</span>
            </li>
        
            <!-- Security -->
            <li class="mb-2 p-2 rounded cursor-pointer flex items-center space-x-2 relative" id="step3" onclick="showStep(3)">
                <div class="flex flex-col items-center">
                    <img src="./images/3.jpg" alt="Security Icon" class="w-6 h-6">
                </div>
                <span class="font-semibold">Security</span>
            </li>
        </ul>
        
    </div>


    
        <!-- Form Section -->
        <div class="w-3/4 bg-white p-6 rounded-lg shadow-md ml-6 overflow-y-auto max-h-screen">
            <h2 class="text-3xl font-bold text-center text-gray-800 mb-4">Vendor Registration</h2>
            <p class="text-gray-600 text-center mb-6">Register your business with us</p>
    
            <form id="registrationForm">
                <!-- Basic Details -->
                <div id="formStep1">
                    <div class="mb-4">
                        <label class="block text-gray-700 font-medium">First Name</label>
                        <input type="text" id="firstName" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#F47458] bg-[#FFF6F4]" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 font-medium">Last Name</label>
                        <input type="text" id="lastName" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#F47458] bg-[#FFF6F4]" required>
                    </div>
                    <button type="button" onclick="showStep(2)" class="bg-[#F47458] text-white py-2 px-4 rounded">Next</button>

                </div>
    
                <!-- Business Details -->
<div id="formStep2" class="hidden">
    <div class="mb-4">
        <label class="block text-gray-700 font-medium">Business Name</label>
        <input type="text" id="businessName" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#F47458] bg-[#FFF6F4]" required>
    </div>
    <div class="mb-4">
        <label class="block text-gray-700 font-medium">Business Email</label>
        <input type="email" id="email" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#F47458] bg-[#FFF6F4]" required>
    </div>
    <div class="mb-4">
        <label class="block text-gray-700 font-medium">Business Category</label>
        <select id="businessCategory" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#F47458] bg-[#FFF6F4]" required>
            <option value="">Select a category</option>
            <option value="Retail">Retail</option>
            <option value="Wholesale">Wholesale</option>
            <option value="Manufacturing">Manufacturing</option>
            <option value="Services">Services</option>
        </select>
    </div>
    <div class="mb-4">
        <label class="block text-gray-700 font-medium">Shop Address</label>
        <input type="text" id="shopAddress" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#F47458] bg-[#FFF6F4]" required>
    </div>

    <!-- State Selection -->
    <div class="mb-4">
        <label class="block text-gray-700 font-medium">State</label>
        <select id="state" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#F47458] bg-[#FFF6F4]" required onchange="updateCities()">
            <option value="">Select a State</option>
            <option value="Maharashtra">Maharashtra</option>
            <option value="Karnataka">Karnataka</option>
            <option value="Delhi">Delhi</option>
            <option value="Gujarat">Gujarat</option>
        </select>
    </div>

    <!-- City Selection -->
    <div class="mb-4">
        <label class="block text-gray-700 font-medium">City</label>
        <select id="city" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#F47458] bg-[#FFF6F4]" required>
            <option value="">Select a City</option>
        </select>
    </div>

    <div class="mb-4">
        <label class="block text-gray-700 font-medium">CIN Number</label>
        <input type="text" id="cinNumber" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#F47458] bg-[#FFF6F4]" required>
    </div>
    <div class="mb-4">
        <label class="block text-gray-700 font-medium">GST Number</label>
        <input type="text" id="gstNumber" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#F47458] bg-[#FFF6F4]" required>
    </div>
    <div class="mb-4">
        <label class="block text-gray-700 font-medium">GST Certificate Upload</label>
        <input type="file" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#F47458] bg-[#FFF6F4]" required>
    </div>
    <div class="mb-4">
        <label class="block text-gray-700 font-medium">Aadhar Number</label>
        <input type="text" id="aadharNumber" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#F47458] bg-[#FFF6F4]" required>
    </div>
    <div class="mb-4">
        <label class="block text-gray-700 font-medium">Aadhar Upload</label>
        <input type="file" class="w-full p-2 border border-gray-300 rounded-lg" required>
    </div>
    <div class="mb-4">
        <label class="block text-gray-700 font-medium">PAN Number</label>
        <input type="text" id="panNumber" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#F47458] bg-[#FFF6F4]" required>
    </div>
    <div class="mb-4">
        <label class="block text-gray-700 font-medium">PAN Upload</label>
        <input type="file" class="w-full p-2 border border-gray-300 rounded-lg" required>
    </div>

    <button type="button" onclick="showStep(1)" class="bg-[#FFF6F4] text-black py-2 px-4 rounded">Back</button>

    <button type="button" onclick="showStep(3)" class="bg-[#F47458] text-white py-2 px-4 rounded">Next</button>
</div>
    
                <!-- Security Details -->
                <div id="formStep3" class="hidden">
                    <div class="mb-4">
                        <label class="block text-gray-700 font-medium">Password</label>
                        <input type="password" id="password" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#F47458] bg-[#FFF6F4]" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 font-medium">Confirm Password</label>
                        <input type="password" id="confirmPassword" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#F47458] bg-[#FFF6F4]" required>
                    </div>
                    <button type="button" onclick="showStep(2)" class="bg-[#FFF6F4] text-black py-2 px-4 rounded">Back</button>

                    <button type="submit" class="bg-[#F47458] text-white py-2 px-4 rounded">Register</button>

                </div>
            </form>
        </div>
    </div>
    


    <script>

function showStep(step) {
    // Hide all steps
    document.getElementById("formStep1").classList.add("hidden");
    document.getElementById("formStep2").classList.add("hidden");
    document.getElementById("formStep3").classList.add("hidden");

    // Show the selected step
    document.getElementById(`formStep${step}`).classList.remove("hidden");

    // Remove active styles from all step indicators
    document.getElementById("step1").classList.remove("bg-blue-200");
    document.getElementById("step2").classList.remove("bg-blue-200");
    document.getElementById("step3").classList.remove("bg-blue-200");

    // Highlight the active step
    document.getElementById(`step${step}`).classList.add("bg-blue-200");
}

// Initialize first step
document.addEventListener("DOMContentLoaded", function () {
    showStep(1);
});


//form validation

document.getElementById("registrationForm").addEventListener("submit", function(event) {
    event.preventDefault(); // Prevent form submission if validation fails
    
    let isValid = true;
    
    // First Name & Last Name Validation (No numbers or special characters)
    const namePattern = /^[a-zA-Z ]+$/;
    const firstName = document.getElementById("firstName");
    const lastName = document.getElementById("lastName");
    if (!namePattern.test(firstName.value.trim())) {
        alert("First Name should contain only letters.");
        isValid = false;
    }
    if (!namePattern.test(lastName.value.trim())) {
        alert("Last Name should contain only letters.");
        isValid = false;
    }
    
    // Email Validation
    const email = document.getElementById("email");
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailPattern.test(email.value.trim())) {
        alert("Enter a valid email address.");
        isValid = false;
    }
    
    // Business Name Validation (Non-empty)
    const businessName = document.getElementById("businessName");
    if (businessName.value.trim() === "") {
        alert("Business Name cannot be empty.");
        isValid = false;
    }
    
    // Dropdown Validation
    const businessCategory = document.getElementById("businessCategory");
    const state = document.getElementById("state");
    const city = document.getElementById("city");
    if (businessCategory.value === "") {
        alert("Please select a Business Category.");
        isValid = false;
    }
    if (state.value === "") {
        alert("Please select a State.");
        isValid = false;
    }
    if (city.value === "") {
        alert("Please select a City.");
        isValid = false;
    }
    
    // Number Validation (CIN, GST, Aadhar, PAN should be numeric & of specific lengths)
    const numberPattern = /^[0-9]+$/;
    const cin = document.getElementById("cinNumber");
    const gst = document.getElementById("gstNumber");
    const aadhar = document.getElementById("aadharNumber");
    const pan = document.getElementById("panNumber");
    
    if (!numberPattern.test(cin.value) || cin.value.length !== 21) {
        alert("CIN Number must be exactly 21 digits long.");
        isValid = false;
    }
    if (!numberPattern.test(gst.value) || gst.value.length !== 15) {
        alert("GST Number must be exactly 15 digits long.");
        isValid = false;
    }
    if (!numberPattern.test(aadhar.value) || aadhar.value.length !== 12) {
        alert("Aadhar Number must be exactly 12 digits long.");
        isValid = false;
    }
    if (!numberPattern.test(pan.value) || pan.value.length !== 10) {
        alert("PAN Number must be exactly 10 characters long.");
        isValid = false;
    }
    
    // Password Validation (Minimum 6 characters, at least one number and one special character)
    const password = document.getElementById("password");
    const confirmPassword = document.getElementById("confirmPassword");
    const passwordPattern = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{6,}$/;
    if (!passwordPattern.test(password.value)) {
        alert("Password must be at least 6 characters long, contain one number, and one special character.");
        isValid = false;
    }
    if (password.value !== confirmPassword.value) {
        alert("Passwords do not match.");
        isValid = false;
    }
    
    // File Upload Validation
    const gstFile = document.querySelector("input[type=file][id='gstCertificate']");
    const aadharFile = document.querySelector("input[type=file][id='aadharUpload']");
    const panFile = document.querySelector("input[type=file][id='panUpload']");
    
    if (gstFile.files.length === 0) {
        alert("Please upload GST Certificate.");
        isValid = false;
    }
    if (aadharFile.files.length === 0) {
        alert("Please upload Aadhar.");
        isValid = false;
    }
    if (panFile.files.length === 0) {
        alert("Please upload PAN.");
        isValid = false;
    }
    
    if (isValid) {
        alert("Form submitted successfully!");
        this.submit(); // Submit the form
    }
});






//fetch API for registration
document.getElementById("registrationForm").addEventListener("submit", async function(event) {
    event.preventDefault();

    // Create FormData object to handle text inputs and file uploads
    const formData = new FormData();

    formData.append("firstName", document.getElementById("firstName").value.trim());
    formData.append("lastName", document.getElementById("lastName").value.trim());
    formData.append("businessName", document.getElementById("businessName").value.trim());
    formData.append("businessCategory", document.getElementById("businessCategory").value);
    formData.append("email", document.getElementById("email").value.trim());
    formData.append("city", document.getElementById("city").value.trim());
    formData.append("state", document.getElementById("state").value.trim());
    formData.append("businessAddress", document.getElementById("shopAddress").value.trim());
    formData.append("gstNumber", document.getElementById("gstNumber").value.trim());
    formData.append("cinNumber", document.getElementById("cinNumber").value.trim());
    formData.append("aadharNumber", document.getElementById("aadharNumber").value.trim());
    formData.append("panNumber", document.getElementById("panNumber").value.trim());
    formData.append("password", document.getElementById("password").value);

    // Handling file inputs and converting them to Blob
    const gstFile = document.querySelector('input[type="file"]').files[0];
    const aadharFile = document.querySelectorAll('input[type="file"]')[1].files[0];
    const panFile = document.querySelectorAll('input[type="file"]')[2].files[0];

    if (gstFile) {
        const gstBlob = new Blob([gstFile], { type: gstFile.type });
        formData.append("gstImage", gstBlob, gstFile.name);
        console.log("GST Certificate Blob:", gstBlob);
    }

    if (aadharFile) {
        const aadharBlob = new Blob([aadharFile], { type: aadharFile.type });
        formData.append("aadharImage", aadharBlob, aadharFile.name);
        console.log("Aadhar Upload Blob:", aadharBlob);
    }

    if (panFile) {
        const panBlob = new Blob([panFile], { type: panFile.type });
        formData.append("panImage", panBlob, panFile.name);
        console.log("PAN Upload Blob:", panBlob);
    }

    // Logging form data
    for (let pair of formData.entries()) {
        if (pair[1] instanceof Blob) {
            console.log(`${pair[0]}: ${pair[1].size} bytes, type: ${pair[1].type}`);
        } else {
            console.log(`${pair[0]}: ${pair[1]}`);
        }
    }

    // Password validation
    const password = document.getElementById("password").value;
    const confirmPassword = document.getElementById("confirmPassword").value;

    if (!password || !confirmPassword || password !== confirmPassword) {
        alert("Passwords do not match!");
        return;
    }

    try {
        const response = await fetch("http://192.168.1.29:8080/api/vendor/register", {
            method: "POST",
            body: formData
        });

        const result = await response.json();

        if (response.ok) {
            alert("Registration Successful! Redirecting to login page.");
            window.location.href = "index.html";
        } else {
            alert(result.message || "Registration failed! Please try again.");
        }
    } catch (error) {
        console.error("Error:", error);
        alert("An error occurred. Please try again later.");
    }
});


//form state city data;
function updateCities() {
        const state = document.getElementById("state").value;
        const citySelect = document.getElementById("city");

        // Clear existing city options
        citySelect.innerHTML = '<option value="">Select a City</option>';

        // Define cities based on states
        const cityOptions = {
            "Maharashtra": ["Mumbai", "Pune", "Nagpur", "Nashik"],
            "Karnataka": ["Bangalore", "Mysore", "Mangalore"],
            "Delhi": ["New Delhi", "Dwarka", "Karol Bagh"],
            "Gujarat": ["Ahmedabad", "Surat", "Vadodara", "Rajkot"]
        };

        // Add new options
        if (state in cityOptions) {
            cityOptions[state].forEach(city => {
                let option = document.createElement("option");
                option.value = city;
                option.textContent = city;
                citySelect.appendChild(option);
            });
        }
    }


    </script>
    
</body>
</html>
